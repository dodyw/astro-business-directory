---
import type { Business } from '../../types';

export async function getStaticPaths() {
  const response = await fetch('http://localhost:4321/businesses.json');
  const data = await response.json();
  
  return data.businesses.map((business: Business) => ({
    params: { slug: `${business.category.join('/')}/${business.slug}` },
    props: { business }
  }));
}

const { business } = Astro.props as { business: Business };

function renderCategoryBreadcrumbs(categoryPath: string[]) {
  return categoryPath.map((cat, index) => {
    const path = categoryPath.slice(0, index + 1).join('/');
    return `<a href="/${path}">${cat}</a>`;
  }).join(' > ');
}
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>{business.name} - Business Directory</title>
	</head>
	<body>
		<header>
			<h1>{business.name}</h1>
			<a href="/">Back to Home</a>
		</header>
		<main>
			<div class="business-detail">
				<p><strong>Category:</strong> <Fragment set:html={renderCategoryBreadcrumbs(business.category)} /></p>
				<p><strong>Description:</strong> {business.description}</p>
				<p><strong>Address:</strong> {business.address}</p>
				<p><strong>Phone:</strong> {business.phone}</p>
				<p><strong>Website:</strong> <a href={business.website} target="_blank" rel="noopener noreferrer">{business.website}</a></p>
			</div>
		</main>
		<footer>
			<p>&copy; 2023 Business Directory. All rights reserved.</p>
		</footer>
	</body>
</html>

<style>
	body {
		font-family: Arial, sans-serif;
		line-height: 1.6;
		margin: 0;
		padding: 0;
		background-color: #f0f0f0;
	}

	header, footer {
		background-color: #333;
		color: #fff;
		text-align: center;
		padding: 1rem;
	}

	header h1 {
		margin: 0;
	}

	header a {
		color: #fff;
		text-decoration: none;
		margin-top: 0.5rem;
		display: inline-block;
	}

	main {
		max-width: 800px;
		margin: 0 auto;
		padding: 2rem;
	}

	.business-detail {
		background-color: #fff;
		border-radius: 8px;
		padding: 2rem;
		box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
	}

	.business-detail p {
		margin-bottom: 1rem;
	}

	a {
		color: #0066cc;
		text-decoration: none;
	}

	a:hover {
		text-decoration: underline;
	}
</style>